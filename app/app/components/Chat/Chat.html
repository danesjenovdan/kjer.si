<Page ref="pageRef" class="page">

  <AbsoluteLayout>

    <GridLayout ref="appContainer" rows="70, 0, *, auto" width="100%" height="100%">

      <GridLayout class="chat-page-header-container" row="0" columns="70, *, 70">
        <Rippler rippleColor="#777777" rippleBorderRadius="50" margin="5" @tap="onBackTap" col="0">
          <Image class="page-header-icon" src="~/assets/images/back_icon.png" height="60"
                 stretch="aspectFit"/>
        </Rippler>
        <Label verticalAlignment="center" class="page-header-title" :text="roomName" col="1"></Label>
        <Rippler rippleColor="#777777" rippleBorderRadius="50" margin="5" @tap="onMenuTap" col="2">
          <Image class="page-header-icon" src="~/assets/images/more_icon.png" height="60"
                 stretch="aspectFit"/>
        </Rippler>
      </GridLayout>

<!--      <StackLayout row="1" @tap="onNewEventTap" class="event-label-container">-->
<!--        <Label class="event-label" text="Ni dogodkov. Ustvari novega?"></Label>-->
<!--      </StackLayout>-->

      <ListView ref="chatListView"
                row="2"
                for="message in messages"
                @itemTap="onItemTap"
                separatorColor="#ffffff"
                verticalAlignment="bottom">
        <v-template name="text" if="!message.type || message.type === 'TEXT'">
          <WrapLayout class="message-container" orientation="vertical" paddingRight="50">
            <Label class="message-user-name-label" :text="message.author?message.author.nickname:'Nekdo drug'"/>
            <StackLayout horizontalAlignment="left" class="message-text-label-container">
              <Label class="message-text-label" :text="message.content" textWrap="true"/>
            </StackLayout>
          </WrapLayout>
        </v-template>

        <v-template name="my_text" if="message.type === 'MY_TEXT'">
          <!-- Shows the list item label in the default color and style. -->
          <StackLayout>
            <WrapLayout class="message-container message-me-container" orientation="vertical"
                        horizontalAlignment="right" paddingLeft="50">
              <Label class="message-user-name-label" text="Jaz" horizontalAlignment="right"/>
              <StackLayout horizontalAlignment="left"
                           class="message-text-label-container message-me-text-label-container">
                <Label class="message-text-label" :text="message.content" textWrap="true"/>
              </StackLayout>
            </WrapLayout>
          </StackLayout>
        </v-template>

      </ListView>

      <GridLayout row="3" class="chat-page-input-container" columns="*, 50">
        <!-- v-keyboard-send-->
        <!-- v-auto-focus -->
        <TextView ref="messageTextView"
                  @tap="onTextViewTap"
                  v-model="messageText"
                  hint="Napiši sporočilo..."
                  class="chat-page-text-view"
                  col="0"></TextView>
        <Image class="chat-page-send-icon" @tap="onSendTap" col="1" verticalAlignment="top"
               src="~/assets/images/send_message_icon.png"
               stretch="aspectFit"/>
      </GridLayout>

    </GridLayout>

    <GridLayout v-if="showMenu" translateY="-10" v-animate-in @tap="onContainerTap" rows="auto, *" columns="*, auto"
                width="100%" height="100%" class="chat-menu-outer-container">
      <StackLayout translateY="50" row="0" class="chat-menu-container" v-shadow="6" col="1">
        <!--        <Label @tap="onEventsTap" class="chat-menu-button" text="Dogodki"></Label>-->
        <StackLayout @tap="onNotificationToggleTap" orientation="horizontal"
                     class="chat-menu-button" width="220">
          <Label text="Notifikacije" verticalAlignment="center"></Label>
          <StackLayout class="chat-menu-button-toggle-container" horizontalAlignment="right" verticalAlignment="center">
            <Switch marginLeft="20" :checked="enabledNotifications" v-model="enabledNotifications"
                    @checkedChange="onNotificationCheckedChange($event)"></Switch>
          </StackLayout>
        </StackLayout>

        <StackLayout @tap="onReportTap" orientation="horizontal"
                     class="chat-menu-button">
          <Label verticalAlignment="center" text="Neprimerna vsebina"></Label>
        </StackLayout>

        <StackLayout @tap="onLeaveRoomTap" orientation="horizontal"
                     class="chat-menu-button chat-menu-button-last">
          <Label verticalAlignment="center" text="Zapusti"></Label>
        </StackLayout>

        <!--        <Label class="chat-menu-button" text="Utišaj"></Label>-->
        <!--        <StackLayout orientation="horizontal" class="chat-menu-button chat-menu-button-last">-->
        <!--          <Label verticalAlignment="center" text="Nastavitve"></Label>-->
        <!--        </StackLayout>-->
      </StackLayout>
    </GridLayout>

  </AbsoluteLayout>

</Page>
